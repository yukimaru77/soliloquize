<!DOCTYPE html>
<html lang="jp">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <div class="content">
    <h2 class="main_theme">シェル</h2>
    <h3 class="subtitle">シェルとは</h3>
    <p>シェルとはユーザーからのコマンドを受け付け、実行するプロググラムのことです。Linuxにログインした時に起動するのはログインシェルと、windowsのシェルはコマンドプロンプトといいます。シェルにもBourneシェル、それを改良したbashやKsh、c言語に似たcshやtcsh、高機能なzshなど様々な種類があります。</p>
    <h3 class="subtitle">シェル変数と環境変数</h3>
    <p>シェルには変数が2種類あります。シェル変数はそのシェルプロセスの実で有効な変数であり変数=値で定義できて、参照は$変数名やダブルクォーテーションの中で$変数名でできます。子プロセスには引き継がれないのでシェルスクリプトやbashコマンドで子プロセスのシェルを立ち上げても参照できません。もう一つは環境変数です。環境変数はexport 変数名で定義します。子プロセスにも引き継がれ、参照方法は同じです。</p>
    <h3 class="subtitle">コマンドの実行制御</h3>
    <p>コマンドは1行に一つではなく条件分岐付きで複数個書くこともできます。</p>
    <p>コマンドは終了後、終了ステータスという物に数字が格納される$?で参照可能です。</p>
    <div class="kind">
      <table>
        <tr>
          <th>書式</th>
          <th>説明</th>
        </tr>
        <tr>
          <td>コマンド1 ; コマンド2</td>
          <td>コマンド1が終了した後コマンド2を行う</td>
        </tr>
        <tr>
          <td>コマンド1 & コマンド2</td>
          <td>コマンド1が終了するのを待たずにコマンド2を行う</td>
        </tr>
        <tr>
          <td>コマンド1 && コマンド2</td>
          <td>コマンド1が正常終了した場合(終了ステータス0)、コマンド2を行う</td>
        </tr>
        <tr>
          <td>コマンド1 || コマンド2</td>
          <td>コマンド1が正常終了しなかった場合(終了ステータス0以外)、コマンド2を行う</td>
        </tr>
      </table>
    </div>
    <h3 class="subtitle">クォーテーション、文字列展開</h3>
    <p>[']シングルクォーテーションの中はすべて文字列と認識されます。$変数名もそのまま展開されずに認識されます。</p>
    <p>["]ダブルクォーテーションの中は文字列と認識されますが[']と違い$変数名は展開されて表示されます。</p>
    <p>['コマンド`]及び$(コマンド)はコマンドの実行結果が展開されます。以下が例です。</p>
    <pre class="proguraming">echo &quot;カレントディレクトリは$(pwd)です&quot;
      カレントディレクトリは/home/yukkyです</pre>
    <h3 class="subtitle">ストリーム</h3>
    <p>ストリームとはデータの入出力によるデータの流れのことをいいます。わかりずらいのでデータが流れる経路と考えてもいいと思います。"ファイル"からデータを読み込むストリームを入力、データを書き込むストリームを出力といいます。普通に思い浮かべるような"ファイル"であれば書き込めば保存可能ですが入出力において保存は保証されてなくてかまいません。</p>
    <p>先ほど"普通に思い浮かべるファイル"といったのは、実はファイルはかなり広いものだからです。データ＝ファイルではありません。バイト列としてデータを読み込んだり書き込んだりどちらかができるもののことです。つまり保存ができるかどうかは関係ありません。データを入れたり出したり(=流す)が出来ればそれはファイルなのです。ハードディスクはもちろん、キーボードやディスプレイもファイルといえます。</p>
    <h3 class="subtitle">標準入出力</h3>
    <p>正確には標準入出力ストリーム、というのが正しいと思います(多分)。ですが私たちはストリームという言葉を省略して標準入出力などと言ったりしています。</p>
    <p>標準入力、標準出力について説明します。まず入力及び出力とはプロセスに入るデータのストリームのことを言います。つまりプロセスに入っていくデータの経路が入力、プロセスから出ていくデータの経路を出力といいます。また、ストリームの識別子をファイルディスクリプタといいファイルディスクリプタはファイルをopenしなければ割り当てられないがデフォルトでopenしているファイルがある。そのファイルディスクリプタが0、1(2もある)であり、そのストリームは通常はキーボード及びディスプレイへのものです。ファイルディスクリプタ0を使うのが標準入力、ファイルディスクリプタ1を使うのが標準出力です。</p>
    <p>もうちょっとファイルディスクリプタを詳細に説明すると(以下<a href="https://qiita.com/hasegit/items/2598963393e0395685f6">こちら</a>より抜粋)FDは「fd_arrayという配列にある、ファイルオブジェクトを指し示すポインタを指し示すポインタ」です。要はポインタなのでファイルディスクリプタは何かの場所をさしてるんだなーって認識が重要だと思います。</p>
    <h3 class="subtitle">パイプ、リダイレクト</h3>
    <p>パイプとは | の記号であらわされ左のコマンドの出力を右のコマンドの入力につなげる。</p>
    <p>リダイレクトとはコマンドの入出力ストリーム先を変更することができます。</p>
    <div class="kind">
      <table>
        <tr>
          <th>書式</th>
          <th>説明</th>
        </tr>
        <tr>
          <td>&gt; ファイル</td>
          <td>出力を指定したファイルに行う(中身は一旦消される)</td>
        </tr>
        <tr>
          <td>&gt;&gt; ファイル</td>
          <td>出力を指定したファイルに行う(中身は消されず追記される)</td>
        </tr>
        <tr>
          <td>&lt; ファイル</td>
          <td>入力を指定したファイルから行う</td>
        </tr>
        <tr>
          <td>コマンド 2&gt; ファイル</td>
          <td>エラー出力を指定したファイルに行う(中身は一旦消される)</td>
        </tr>
        <tr>
          <td>コマンド 2&gt;&gt; ファイル</td>
          <td>エラー出力を指定したファイルに行う(中身は消されず追記される)</td>
        </tr>
        <tr>
          <td>ファイルディスクリプタa &gt;& ファイルディスクリプタb</td>
          <td>ファイルディスクリプタaをファイルディスクリプタbにマージする。(ファイルディスクリプタaを省略した場合は1になる)</td>
        </tr>
      </table>
    </div>
    <p>なお、ファイルディスクリプタaをファイルディスクリプタbにマージする。という説明は実際のところ違います。ほとんどの時はこう考えといていいですがダメな時があるので補足説明を入れます。</p>
    <h4>本当のファイルディスクリプタa &gt;& ファイルディスクリプタb</h4>
    <p><a href="https://qiita.com/hasegit/items/da8c3de3cd040d4d6c5d">こちら</a>のc項を参考(丸パクリ)しました。凄いです。というか正直難しいです。</p>
    <p>結論から言うとシステムコールのdup2関数が正体です。dup2関数は<a href="https://miyanetdev.com/archives/580">こちら</a>が分かりやすいです。以下抜粋です</p>
    <p>dup()は引数として受け取ったファイルディスクリプタoldfdのコピーを作成したのち、使われていない最も小さい番号のファイルディスクリプタを新しいディスクリプタとして使用します。</p>
    <p>一方でdup2()では使われていない最も小さい番号のファイルディスクリプタを使う代わりに引数のnewfdで指定されたディスクリプタが指す番号を使用します。</p>
    <p>newfdがすでに使われている場合にはそのディスクリプタをクローズしてから再利用します。</p>


  </div>
</body>

<script src="../script.js"></script>
</html>